{"ast":null,"code":"// frontend/src/shared/services/api.js\nimport axios from'axios';const API_URL=process.env.REACT_APP_API_URL||'https://уралплата.рф/api';const api=axios.create({baseURL:API_URL,withCredentials:true});api.interceptors.request.use(config=>{const token=localStorage.getItem('token');if(token){config.headers.Authorization=`Bearer ${token}`;}return config;},error=>{return Promise.reject(error);});// Добавляем интерцептор для обработки ошибок\napi.interceptors.response.use(response=>response,error=>{var _error$response;if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401&&window.location.pathname.startsWith('/admin')){localStorage.removeItem('token');// Удаляем невалидный токен\nwindow.location.href='/login';// Перенаправляем на страницу логина только для админ-маршрутов\n}return Promise.reject(error);});export const categoryAPI={getCategories:()=>api.get('/categories'),createCategory:data=>api.post('/categories',data),updateCategory:(id,data)=>api.put(`/categories/${id}`,data),deleteCategory:id=>api.delete(`/categories/${id}`)};export const authAPI={login:credentials=>api.post('/auth/login',credentials),register:data=>api.post('/auth/register',data),// Добавляем метод регистрации\nlogout:()=>{localStorage.removeItem('token');window.location.href='/login';}};export const productAPI={getProductsByCategoryId:categoryId=>api.get(`/categories/${categoryId}/products`),createProduct:async(categoryId,productData)=>{try{console.log('Sending request to create product:',{categoryId,productData});const response=await api.post(`/categories/${categoryId}/products`,productData);console.log('Product created successfully:',response.data);return response.data;}catch(error){var _error$response2;console.error('Error creating product:',((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data)||error.message);throw error;}},updateProduct:(id,data)=>api.put(`/products/${id}`,data),deleteProduct:async id=>{try{const response=await api.delete(`/products/${id}`);return response;}catch(error){console.error('Error deleting product:',error);throw error;}}};export default api;","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","api","create","baseURL","withCredentials","interceptors","request","use","config","token","localStorage","getItem","headers","Authorization","error","Promise","reject","response","_error$response","status","window","location","pathname","startsWith","removeItem","href","categoryAPI","getCategories","get","createCategory","data","post","updateCategory","id","put","deleteCategory","delete","authAPI","login","credentials","register","logout","productAPI","getProductsByCategoryId","categoryId","createProduct","productData","console","log","_error$response2","message","updateProduct","deleteProduct"],"sources":["/root/frontend/src/shared/services/api.js"],"sourcesContent":["// frontend/src/shared/services/api.js\nimport axios from 'axios';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'https://уралплата.рф/api';\n\nconst api = axios.create({\n  baseURL: API_URL,\n  withCredentials: true\n});\n\napi.interceptors.request.use((config) => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, (error) => {\n  return Promise.reject(error);\n});\n\n// Добавляем интерцептор для обработки ошибок\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    if (error.response?.status === 401 && window.location.pathname.startsWith('/admin')) {\n      localStorage.removeItem('token'); // Удаляем невалидный токен\n      window.location.href = '/login'; // Перенаправляем на страницу логина только для админ-маршрутов\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport const categoryAPI = {\n  getCategories: () => api.get('/categories'),\n  createCategory: (data) => api.post('/categories', data),\n  updateCategory: (id, data) => api.put(`/categories/${id}`, data),\n  deleteCategory: (id) => api.delete(`/categories/${id}`)\n};\n\nexport const authAPI = {\n  login: (credentials) => api.post('/auth/login', credentials),\n  register: (data) => api.post('/auth/register', data), // Добавляем метод регистрации\n  logout: () => {\n    localStorage.removeItem('token');\n    window.location.href = '/login';\n  }\n};\n\nexport const productAPI = {\n  getProductsByCategoryId: (categoryId) => \n    api.get(`/categories/${categoryId}/products`),\n  \n  createProduct: async (categoryId, productData) => {\n    try {\n      console.log('Sending request to create product:', { categoryId, productData });\n      const response = await api.post(`/categories/${categoryId}/products`, productData);\n      console.log('Product created successfully:', response.data);\n      return response.data;\n    } catch (error) {\n      console.error('Error creating product:', error.response?.data || error.message);\n      throw error;\n    }\n  },\n  \n  updateProduct: (id, data) => \n    api.put(`/products/${id}`, data),\n  \n  deleteProduct: async (id) => {\n    try {\n      const response = await api.delete(`/products/${id}`);\n      return response;\n    } catch (error) {\n      console.error('Error deleting product:', error);\n      throw error;\n    }\n  },\n};\n\nexport default api;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}